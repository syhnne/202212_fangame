## 牢记一件事！！！你把nvl界面整个删掉了！！！所以不要写nvl
## 控制结局解锁 #################################################################
$ persistent.ending1 = False
$ persistent.ending2 = False
$ persistent.ending3 = False
$ persistent.ending4 = False
$ persistent.ending5 = False
$ persistent.ending6 = False
$ persistent.ending7 = False
$ persistent.ending8 = False

## 定义角色和变量 ###############################################################

## 角色
define test = Character('test')

## 变量
default pov = None ##为了让我以后能少打几个字，这东西是个布尔值，True是钟离视角，False是公子视角
default time = 0 ## 由于时间那个dict不能用list作为value，只好把它做成一个整数，需要判断日期或者时间（指的是上午，下午，晚上那个时间），要用一个函数



## 部分主控流程需要用到的屏幕，先不搬过去了 #######################################
init python:
    def date(time):## 判断日期。举个例子，time的0,1,2分别指代第一天的早晨，下午，晚上；3,4,5分别指代第二天的早晨，下午，晚上……
        date = (time//3)+1
        return date

    def clock(time):## 判断时间。因为time这个词被我用过了，所以换成clock，不要在意这些细节。
        clock = time%3
        return clock



screen days:
    zorder 50
    frame:
        align (0.1,0.1)
        text 'time:[time]'



screen pov_toggle: ## 切换视角时使用的界面
    modal True
    zorder 100
    ## 一下部分有空重写！现在我没功夫画画，等画出来之后改成imagemap
    frame:
        textbutton '钟离' action [SelectedIf(SetVariable(pov, True)), Jump('turn')]
        textbutton '达达利亚' action [SelectedIf(SetVariable(pov, False)), Jump('turn')]
        textbutton '返回' action Return()

screen choice_z(clock):
    zorder 0
    tag map

    if clock == 0:
        imagemap:
            auto 'gui/map/map_%s.png'
            hotspot (1300,400,200,200) action Call('test_z')
    elif clock == 1:
        imagemap:
            auto 'gui/map/map_%s.png'
            hotspot (1300,400,200,200) action Call('test_z')
    else:
        imagemap:
            auto 'gui/map/map_%s.png'
            hotspot (1300,400,200,200) action Call('test_z')


screen choice_c(clock):
    zorder 0
    tag map
    if clock == 0:
        imagemap:
            auto 'gui/map/map_%s.png'
            hotspot (1300,400,200,200) action Call('test_c')
    elif clock == 1:
        imagemap:
            auto 'gui/map/map_%s.png'
            hotspot (1300,400,200,200) action Call('test_c')
    else:
        imagemap:
            auto 'gui/map/map_%s.png'
            hotspot (1300,400,200,200) action Call('test_c')


## 剧情流程 ####################################################################
label turn:

    if date(time) <= 30:
        if pov:
            $ event = events_z.get(time)

            if not event:
                call screen choice_z(clock(time))
            else:
                call event

        else:
            $ event = events_c.get(time)
            $ time = time + 1
            if not event:
                call screen choice_c(clock(time))
            else:
                call event


    else:
        jump ending1


## 特殊事件和流程 ###############################################################
## 这个dict中的key为时间，是一个整数；value为特殊事件的label名称，是一个字符串
## 另外根据我后来的思考，这个dict要做很多个。
## 前两个角色的dict，指的是到了特定的时间，就会跳过选择地点的部分，强制执行的剧情。
## 后面地名的dict，是选择了特定的地点之后才会出现的。
init python:
    events_z = {

    }

    events_c = {

    }





################################################################################
## 下面是真的剧情 ###############################################################
################################################################################

label splashscreen:
    '测试一下这个能不能运行'
    '好，可以（喜）'
    return


label start:
    ## 注：at testmatrix 要写在 with dissolve前面。。

    menu:## 这个界面是临时的！以后我大概会专门画两张背影用来当选择视角的界面，这样才方便做阴间特效啊。
        '请选择初始视角：'
        '钟离':
            $ pov = True
        '达达利亚':
            $ pov = False

    show screen days
    if pov:
        scene bg wanmintang morning with dissolve
        '这是开头的钟离视角'
        '呃，我累了，什么都写不出来，我就是测试一下这个剧情能不能正常地跑'
        call screen choice_z(0)

    else:
        '这是开头的公子视角'
        '我真的会谢，我昨天凹了一晚上就写出来那么几个字，我要不要薅一个人过来帮我写？'
        call screen choice_c(0)
    return

label night:
    '一天结束了'
    jump turn

label test_z:
    $ time = time + 1
    '这是钟离视角'
    '这是一旮瘩测试用的剧情，无论选什么我都会让它跳转到这来'
    jump turn


label test_c:
    $ time = time + 1
    '这是公子视角'
    '别卡bug好吗（双手合十）我耽误不起这个时间，我光是凹剧情就足以消耗完剩下的20天假期，别提什么画cg了'
    jump turn


label ending1:
    scene cg 01 with dissolve
    'lmao'
    return
